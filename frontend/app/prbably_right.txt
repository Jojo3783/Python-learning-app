import React, { useState } from 'react';
import { View, Text, Button, StyleSheet, Alert, TouchableOpacity } from 'react-native';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';

const Stack = createNativeStackNavigator();

// --- 0. éŠæˆ²è³‡æ–™ (å…¨åŸŸè¨­å®š) ---
const LEVELS = [
  { id: 1, name: 'æ–°æ‰‹æ‘', monster: 'å²èŠå§†', hp: 10, color: '#e0f7fa' },
  { id: 2, name: 'é»‘æš—æ£®æ—', monster: 'å¤§èœ˜è››', hp: 50, color: '#d7ccc8' },
  { id: 3, name: 'é­”ç‹åŸ', monster: 'å™´ç«é¾', hp: 100, color: '#ffcdd2' },
];

// --- 1. é¦–é ç•«é¢ (Home) ---
// åŠŸèƒ½ï¼šåªæœ‰ä¸€å€‹å¸¥æ°£çš„æ¨™é¡Œå’Œé–‹å§‹æŒ‰éˆ•
function HomeScreen({ navigation }) {
  return (
    <View style={styles.container}>
      <Text style={styles.title}>ğŸ›¡ï¸ å‚³èªªå°æ±º</Text>
      <Text style={styles.subtitle}>React Native å†’éšªç¯‡</Text>
      
      <View style={styles.btnContainer}>
        <Button 
          title="é–‹å§‹éŠæˆ² (START)" 
          onPress={() => navigation.navigate('LevelSelect')} 
        />
      </View>
    </View>
  );
}

// --- 2. é¸é—œç•«é¢ (LevelSelect) ---
// åŠŸèƒ½ï¼šåˆ—å‡ºæ‰€æœ‰é—œå¡è®“ç©å®¶é¸
function LevelSelectionScreen({ navigation }) {
  return (
    <View style={styles.container}>
      <Text style={styles.headerTitle}>è«‹é¸æ“‡é—œå¡</Text>
      
      {/* ç”¨è¿´åœˆæŠŠæ¯ä¸€é—œéƒ½è®Šæˆä¸€å€‹æŒ‰éˆ• */}
      {LEVELS.map((level, index) => (
        <TouchableOpacity 
          key={level.id}
          style={[styles.levelBtn, { backgroundColor: level.color }]}
          // æŒ‰ä¸‹å»æ™‚ï¼ŒæŠŠã€Œç¬¬å¹¾é—œ (index)ã€é€™å€‹åŒ…è£¹å¯„çµ¦ Game é é¢
          onPress={() => navigation.navigate('Game', { targetLevelIndex: index })}
        >
          <Text style={styles.levelBtnText}>ç¬¬ {level.id} é—œï¼š{level.name}</Text>
        </TouchableOpacity>
      ))}

      <View style={{ marginTop: 20 }}>
        <Button title="å›é¦–é " color="gray" onPress={() => navigation.goBack()} />
      </View>
    </View>
  );
}

// --- 3. éŠæˆ²ç•«é¢ (Game) ---
// åŠŸèƒ½ï¼šå¯¦éš›æˆ°é¬¥
function GameScreen({ navigation, route }) {
  // 1. æ”¶åŒ…è£¹ï¼šçœ‹çœ‹ç©å®¶æ˜¯å¾é¸é—œç•«é¢é»äº†å“ªä¸€é—œé€²ä¾†çš„
  const { targetLevelIndex } = route.params;
  
  // 2. æ‹¿å‡ºé‚£ä¸€é—œçš„è³‡æ–™
  const currentLevel = LEVELS[targetLevelIndex];

  // æˆ°é¬¥å‹åˆ©çš„é‚è¼¯
  const handleWin = () => {
    Alert.alert("ğŸ‰ å‹åˆ©ï¼", `ä½ æ‰“æ•—äº† ${currentLevel.monster}`, [
      { 
        text: "å›é¸é—œç•«é¢", 
        // goBack æœƒå›åˆ°ä¸Šä¸€é  (ä¹Ÿå°±æ˜¯ LevelSelect)
        onPress: () => navigation.goBack() 
      },
      {
        text: "å›é¦–é ",
        // popToTop æœƒç›´æ¥è¸¢å›æœ€ä¸€é–‹å§‹çš„é‚£é  (Home)
        onPress: () => navigation.popToTop()
      }
    ]);
  };

  return (
    <View style={[styles.container, { backgroundColor: currentLevel.color }]}>
      <Text style={styles.levelTitle}>ç¬¬ {currentLevel.id} é—œ</Text>
      
      <View style={styles.monsterBox}>
        <Text style={{ fontSize: 60 }}>ğŸ‘¾</Text>
        <Text style={styles.monsterName}>{currentLevel.monster}</Text>
        <Text>HP: {currentLevel.hp}</Text>
      </View>

      <View style={styles.btnContainer}>
        <Button title="ç™¼å‹•æ”»æ“Š (Win)" onPress={handleWin} />
        <View style={{ height: 10 }} />
        <Button title="é€ƒè·‘" color="red" onPress={() => navigation.goBack()} />
      </View>
    </View>
  );
}

// --- 4. ä¸»ç¨‹å¼ (å¤§è…¦) ---
export default function App() {
  return (

      <Stack.Navigator initialRouteName="Home">
        
        {/* ç¬¬ä¸€é ï¼šé¦–é  */}
        <Stack.Screen 
          name="Home" 
          component={HomeScreen} 
          options={{ title: 'éŠæˆ²ä¸»é¸å–®' }} 
        />
        
        {/* ç¬¬äºŒé ï¼šé¸é—œå¡ */}
        <Stack.Screen 
          name="LevelSelect" 
          component={LevelSelectionScreen} 
          options={{ title: 'é¸æ“‡é—œå¡' }} 
        />
        
        {/* ç¬¬ä¸‰é ï¼šç©éŠæˆ² */}
        <Stack.Screen 
          name="Game" 
          component={GameScreen} 
          options={{ title: 'æˆ°é¬¥ä¸­' }} 
        />
        
      </Stack.Navigator>
  );
}

// --- 5. æ¨£å¼è¡¨ ---
const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
    padding: 20,
    backgroundColor: '#fff',
  },
  title: { fontSize: 32, fontWeight: 'bold', marginBottom: 10 },
  subtitle: { fontSize: 18, color: '#666', marginBottom: 40 },
  headerTitle: { fontSize: 24, fontWeight: 'bold', marginBottom: 20 },
  
  // æŒ‰éˆ•å®¹å™¨
  btnContainer: { width: 200 },
  
  // è‡ªè¨‚çš„é—œå¡æŒ‰éˆ•æ¨£å¼
  levelBtn: {
    width: '100%',
    padding: 20,
    marginVertical: 10,
    borderRadius: 10,
    alignItems: 'center',
    // é™°å½±
    elevation: 3,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
  },
  levelBtnText: { fontSize: 18, fontWeight: 'bold', color: '#333' },
  
  monsterBox: {
    alignItems: 'center',
    marginBottom: 40,
    padding: 20,
    backgroundColor: 'rgba(255,255,255,0.5)',
    borderRadius: 20,
  },
  monsterName: { fontSize: 24, fontWeight: 'bold', marginVertical: 10 },
  levelTitle: { fontSize: 28, fontWeight: 'bold', marginBottom: 30 },
});